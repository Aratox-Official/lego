<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Simple 3D LEGO Builder</title>
<style>
  body {
    margin: 0;
    background: #222;
    font-family: sans-serif;
    overflow: hidden;
  }

  #controls {
    position: fixed;
    top: 10px;
    left: 10px;
    z-index: 10;
    background: rgba(255,255,255,0.8);
    padding: 10px;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  #direction-buttons {
    display: grid;
    grid-template-columns: 50px 50px 50px;
    grid-template-rows: 50px 50px 50px;
    gap: 5px;
    margin-bottom: 10px;
  }

  #direction-buttons button {
    width: 50px;
    height: 50px;
    font-size: 14px;
  }

  #up { grid-area: 1 / 2 / 2 / 3; }
  #down { grid-area: 3 / 2 / 4 / 3; }
  #left { grid-area: 2 / 1 / 3 / 2; }
  #right { grid-area: 2 / 3 / 3 / 4; }

  /* Toggle button style */
  #build-side-toggle {
    margin-top: 8px;
    padding: 6px 12px;
    font-size: 14px;
    cursor: pointer;
  }

  #scene-container {
    width: 100vw;
    height: 100vh;
    perspective: 1000px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  #scene {
    width: 600px;
    height: 600px;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.5s;
  }

  .block {
    position: absolute;
    width: 40px;
    height: 40px;
    background: #ff5733;
    border: 2px solid #fff;
    box-sizing: border-box;
    border-radius: 4px;
    cursor: pointer;
  }

  .side-wall {
    position: absolute;
    width: 40px;
    height: 40px;
    background: transparent;
    box-sizing: border-box;
    border-radius: 2px;
  }
</style>
</head>
<body>

<div id="controls">
  <div id="direction-buttons">
    <button id="up">↑</button>
    <button id="left">←</button>
    <button id="down">↓</button>
    <button id="right">→</button>
  </div>
  <p>Add blocks by clicking on the top of a Lego block.</p>
  <button id="build-side-toggle">Build Front</button>
  <p>Current build side: <strong id="build-side-label">front</strong></p>
</div>

<div id="scene-container">
  <div id="scene"></div>
</div>

<script>
  const scene = document.getElementById('scene');
  const buildSideLabel = document.getElementById('build-side-label');
  const buildSideToggleBtn = document.getElementById('build-side-toggle');

  let rotationY = 0;
  let rotationX = 0;
  let buildSide = 'front';

  buildSideToggleBtn.addEventListener('click', () => {
    buildSide = (buildSide === 'front') ? 'back' : 'front';
    buildSideLabel.textContent = buildSide;
    buildSideToggleBtn.textContent = `Build ${buildSide === 'front' ? 'Front' : 'Back'}`;
  });

  document.getElementById('up').addEventListener('click', () => {
    rotationX -= 15;
    scene.style.transform = `rotateY(${rotationY}deg) rotateX(${rotationX}deg)`;
  });
  document.getElementById('down').addEventListener('click', () => {
    rotationX += 15;
    scene.style.transform = `rotateY(${rotationY}deg) rotateX(${rotationX}deg)`;
  });
  document.getElementById('left').addEventListener('click', () => {
    rotationY -= 15;
    scene.style.transform = `rotateY(${rotationY}deg) rotateX(${rotationX}deg)`;
  });
  document.getElementById('right').addEventListener('click', () => {
    rotationY += 15;
    scene.style.transform = `rotateY(${rotationY}deg) rotateX(${rotationX}deg)`;
  });

  const gridSize = 10;
  const blockSize = 40;
  const maxHeight = 5;

  const blocks = {};
  
  function createBlock(x, y, height, side) {
    const block = document.createElement('div');
    block.className = 'block';

    block.style.left = `${x * blockSize}px`;
    block.style.top = `${y * blockSize}px`;

    if (side === 'front') {
      block.style.transform = `translateZ(${height * 20}px)`;
    } else if (side === 'back') {
      block.style.transform = `translateZ(-${height * 20}px)`;
    }

    block.style.zIndex = height;
    block.dataset.x = x;
    block.dataset.y = y;
    block.dataset.side = side;

    block.style.background = `hsl(${(x + y + height) * 30 % 360}, 70%, 60%)`;

    scene.appendChild(block);

    const walls = ['left', 'right', 'front', 'back'];
    walls.forEach(sideWall => {
      const wall = document.createElement('div');
      wall.className = 'side-wall';

      switch (sideWall) {
        case 'left':
          wall.style.width = '4px';
          wall.style.height = '40px';
          wall.style.left = '0px';
          wall.style.top = '0px';
          wall.style.transform = `translateX(-2px) translateZ(${height * 20}px)`;
          break;
        case 'right':
          wall.style.width = '4px';
          wall.style.height = '40px';
          wall.style.right = '0px';
          wall.style.top = '0px';
          wall.style.transform = `translateX(2px) translateZ(${height * 20}px)`;
          break;
        case 'front':
          wall.style.width = '40px';
          wall.style.height = '4px';
          wall.style.left = '0px';
          wall.style.bottom = '0px';
          wall.style.transform = `translateZ(${height * 20}px)`;
          break;
        case 'back':
          wall.style.width = '40px';
          wall.style.height = '4px';
          wall.style.left = '0px';
          wall.style.top = '0px';
          wall.style.transform = `translateZ(-${height * 20}px)`;
          break;
      }

      scene.appendChild(wall);
    });
  }

  for (let x = 0; x < gridSize; x++) {
    for (let y = 0; y < gridSize; y++) {
      createBlock(x, y, 0, 'front');
      blocks[`${x},${y}`] = 0;
    }
  }

scene.addEventListener('click', (e) => {
  if (e.target.classList.contains('block') || e.target.classList.contains('side-wall')) {
    const x = parseInt(e.target.dataset.x);
    const y = parseInt(e.target.dataset.y);
    const currentHeight = blocks[`${x},${y}`] || 0;

    const t = e.target.style.transform;
    const match = t.match(/translateZ\((-?\d+\.?\d*)px\)/);
    const clickedZ = match ? parseFloat(match[1]) : 0;
    const isFront = clickedZ >= 0;

    const sideToBuild = buildSide;

    const existingBlocks = Object.keys(blocks).filter(k => {
      const [bx, by] = k.split(',').map(Number);
      return bx === x && by === y;
    });

    let maxZ = 0;
    existingBlocks.forEach(k => {
      const child = Array.from(scene.children).find(c => 
        c.dataset && c.dataset.x === String(x) && c.dataset.y === String(y)
      );
      if (child) {
        const t2 = child.style.transform;
        const m = t2.match(/translateZ\((-?\d+\.?\d*)px\)/);
        if (m) {
          const zVal = parseFloat(m[1]);
          if (zVal > maxZ) maxZ = zVal;
        }
      }
    });

    if (currentHeight < maxHeight) {
      blocks[`${x},${y}`] = currentHeight + 1;
      createBlock(x, y, currentHeight + 1, sideToBuild);
    }
  }
});
</script>
</body>
</html>
